---
message: "This node is using global data"

#Puppet Server Tuning
puppet_enterprise::master::puppetserver::jruby_max_requests_per_instance: 10000
#Enable code manager
puppet_enterprise::profile::master::code_manager_auto_configure: true
puppet_enterprise::master::code_manager::authenticate_webhook: false

#pe-console-services tuning
#https://docs.puppetlabs.com/pe/latest/console_config.html#tuning-the-classifier-synchronization-period
#disable classifier scheduled sync and rely on r10k postrun command to sync the classes
puppet_enterprise::profile::console::classifier_synchronization_period: 0

# Data for the puppetlabs NTP module
#   which interfaces will accept connections
ntp::restrict:
  - 'default kod nomodify notrap nopeer noquery'
  - '-4 default kod notrap nomodify nopeer noquery'
  - '-6 default kod nomodify notrap nopeer noquery'
  - '127.0.0.1'
  - '::1'
ntp::servers:
  - 'time01.samdom.aussieswithtails.fuzzbutt' # ToDo: use fqdn?

virtualbox::version: '5.0'

hiera::hiera_yaml: '/etc/puppetlabs/code/hiera.yaml' # FixMe - can it be paramaratized
hiera::master_service: 'puppetserver'
hiera::hierarchy:
  - "nodes/%{literal('%')}{trusted.certname}"
  - "tier/%{literal('%')}{tier}"
  - global

awt::ssh::key_type: 'rsa'
awt::ssh::key_size: '4096'

# btrfs
awt::btrfs::admin_mountpoint: '/mnt/btrfs'
awt::server_home: '/srv'
awt::nologin_shell: '/usr/sbin/nologin'

# Gitolite settings
# Note that we don't let gitolite manage the user or home directory
# This reflects two issues:
# - The need to setup a btrfs subvolume
# - The puppet mount resource behavior which doesn't respect the underlying
#   directory ownerships - changes them to root which requires a hack to
#   work around.
gitolite::admin_key_source: "%{hiera('gitolite::home_dir')}/.ssh/id_%{hiera('awt::ssh::key_type')}.pub"
gitolite::manage_home_dir: false
gitolite::manage_user: false
gitolite::group_name: 'gitolite'
gitolite::user_name: 'gitolite'
gitolite::home_dir: '/srv/gitolite'
